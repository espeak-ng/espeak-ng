#!/bin/sh

test_phonemes() {
	TEST_LANG=$1
	EXPECTED=$2
	TEST_TEXT=$3

	echo "testing ${TEST_LANG} \"${TEST_TEXT}\""
	ESPEAK_DATA_PATH=`pwd` LD_LIBRARY_PATH=src:${LD_LIBRARY_PATH} \
		src/espeak-ng -xq -v ${TEST_LANG} "${TEST_TEXT}" > actual.txt
	echo "${EXPECTED}" > expected.txt
	diff expected.txt actual.txt || exit 1
}

# word lookup
test_phonemes en " h@l'oU" "hello"

# correct word stress
test_phonemes en " s'VmTIN Imp'o@t@nt" "something important"

# suffix rules
test_phonemes lv \
	" nev'ie:na nuo\`_ 'eiRo:pas v'al>sti:m nek,ad nav p'a:Rga:jusi nuo\`_ 'univERsa:la:s_:_: nuo\` v'ispa:Re:jiem n'uoduok}l^iem f'inanse:tas_:_: s'iste:mas uz 'obliga:ta:s 'apdRuoSina:Sanas s'iste:mu b'eigas" \
	"Neviena no Eiropas valstƒ´m nekad nav pƒÅrgƒÅjusi no universƒÅlƒÅs (no vispƒÅrƒìjiem nodokƒºiem finansƒìtas) sistƒìmas uz obligƒÅtƒÅs apdro≈°inƒÅ≈°anas sistƒìmu Beigas."

# A list entry that uses '$text' to map to another list entry crashes 1.49.2 multi-word support:
test_phonemes en " d'eIbju:tI2d" "d√©buted"
test_phonemes en-US " d'eIbju:t#I#d" "d√©buted"

# bug: https://github.com/nvaccess/nvda/issues/7740
test_phonemes ta " 'il." "‡Æ≥‡Øç"
test_phonemes my " kon'i" "7"
test_phonemes ka " s'ami Sv'idi" "3 7"

# bug: https://github.com/nvaccess/nvda/issues/7805
test_phonemes hi " r'UcI" "‡§∞‡•Å‡§ö‡§ø"
test_phonemes hi " dUk'a:n" "‡§¶‡•Å‡§ï‡§æ‡§®"
test_phonemes hi " ka:n'u:n" "‡§ï‡§æ‡§®‡•Ç‡§®"

#----- Emoji [http://www.unicode.org/reports/tr51/tr51-12.html] -----

# ED-3 - emoji_character
test_phonemes en " 'e@ri:z" "‚ôà"
test_phonemes my " pru3'a2nke3DN_|_| mj@@lu3'a2mj@2tsnh,a2N_|_| nm_|n'e3DN_|_| mj@@nh,ats" "üòô"
test_phonemes ka " k'ots#nis g'amomx,atveli s'axe m'omQim,are t#v'alebit#" "üòô"
test_phonemes ka " 'imedg,ats#ru,ebuli m'agram Sv'ebis g'amomx,atveli s'axe" "üò•"
# TODO: Fix adjacent emoji without whitespace so the pronunciation is separated by a space.
test_phonemes en " 'e@ri:zr'eInboU" "‚ôàüåà"
test_phonemes en " 'e@ri:z r'eInboU" "‚ôà üåà"

# multi-word emoji
test_phonemes en " Ekskla#m'eIS@n kw'EstS@n m'A@k" "‚Åâ"
test_phonemes en " Ekskla#m'eIS@n kw'EstS@n m'A@k r'eInboU" "‚Åâ üåà"
test_phonemes en " r'oUlIN 0nD@ fl'o@ l'aafIN" "ü§£" # skip words

# bug: https://github.com/espeak-ng/espeak-ng/issues/471
test_phonemes sk " sm'eju:tsa s'a tv'a:R" "‚ò∫"
test_phonemes sk " bl'ax sm'eju:tsa s'a tv'a:R" "blah ‚ò∫"

# bug: https://github.com/espeak-ng/espeak-ng/issues/523
# replaced string is longer:
#test_phonemes mk " b'ab'ab'ab'ab'ab'ab'ab'a\n b'@" "B–∞-ba-ba-ba-ba-ba-ba-ba. B"
# replaced string is shorter (Cyrillic to Latin for Croatian):
test_phonemes hr " d'@d,@d,@d,@" "–¥–¥–¥–¥"
# replaced string is longer (Latin to Cyrillic for Macedonian)
test_phonemes mk " b,@b,@b,@b'@" "bbbb"
# Check null delimiters for for rewrittten buffer
## when replaced to shorter string (Cyrillic to Latin for Croatian)
test_phonemes hr " d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad&\n 'EtEd\n d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad&\n d'EtE" "dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada.
ete–¥.
dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada dada.
–¥ete."
## when replaced to longer string
test_phonemes mk " d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad&\n b'ete\n d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad& d'ad&\n d'ete\n 'eteb" "–¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞.
b–µ—Ç–µ.
–¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞ –¥–∞–¥–∞.
–¥ete.
–µ—Ç–µb."


