#!/bin/sh

test_phonemes() {
	TEST_LANG=$1
	EXPECTED=$2
	TEST_TEXT=$3

	echo "testing ${TEST_LANG} \"${TEST_TEXT}\""
	ESPEAK_DATA_PATH=`pwd` LD_LIBRARY_PATH=src:${LD_LIBRARY_PATH} \
		src/espeak-ng -xq -v ${TEST_LANG} "${TEST_TEXT}" > actual.txt
	echo "${EXPECTED}" > expected.txt
	diff expected.txt actual.txt || exit 1
}

# word lookup
test_phonemes en " h@l'oU" "hello"

# correct word stress
test_phonemes en " s'VmTIN Imp'o@t@nt" "something important"

# suffix rules
test_phonemes lv \
	" nev'ie:na nuo\`_ 'eiRo:pas v'al>sti:m nek,ad nav p'a:Rga:jusi nuo\`_ 'univERsa:la:s_:_: nuo\` v'ispa:Re:jiem n'uoduok}l^iem f'inanse:tas_:_: s'iste:mas uz 'obliga:ta:s 'apdRuoSina:Sanas s'iste:mu b'eigas" \
	"Neviena no Eiropas valstÄ«m nekad nav pÄrgÄjusi no universÄlÄs (no vispÄrÄ“jiem nodokÄ¼iem finansÄ“tas) sistÄ“mas uz obligÄtÄs apdroÅ¡inÄÅ¡anas sistÄ“mu Beigas."

# A list entry that uses '$text' to map to another list entry crashes 1.49.2 multi-word support:
test_phonemes en " d'eIbju:tI2d" "dÃ©buted"
test_phonemes en-US " d'eIbju:t#I#d" "dÃ©buted"

# bug: https://github.com/nvaccess/nvda/issues/7740
test_phonemes ta " 'il." "à®³à¯"
test_phonemes my " kon'i" "7"
test_phonemes ka " s'ami Sv'idi" "3 7"

# bug: https://github.com/nvaccess/nvda/issues/7805
test_phonemes hi " r'UcI" "à¤°à¥à¤šà¤¿"
test_phonemes hi " dUk'a:n" "à¤¦à¥à¤•à¤¾à¤¨"
test_phonemes hi " ka:n'u:n" "à¤•à¤¾à¤¨à¥‚à¤¨"

#----- Emoji [http://www.unicode.org/reports/tr51/tr51-12.html] -----

# ED-3 - emoji_character
test_phonemes en " 'e@ri:z" "â™ˆ"
test_phonemes my " pru3'a2nke3DN_|_| mj@@lu3'a2mj@2tsnh,a2N_|_| nm_|n'e3DN_|_| mj@@nh,ats" "ğŸ˜™"
test_phonemes ka " k'ots#nis g'amomx,atveli s'axe m'omQim,are t#v'alebit#" "ğŸ˜™"
test_phonemes ka " 'imedg,ats#ru,ebuli m'agram Sv'ebis g'amomx,atveli s'axe" "ğŸ˜¥"
# TODO: Fix adjacent emoji without whitespace so the pronunciation is separated by a space.
test_phonemes en " 'e@ri:zr'eInboU" "â™ˆğŸŒˆ"
test_phonemes en " 'e@ri:z r'eInboU" "â™ˆ ğŸŒˆ"

# multi-word emoji
test_phonemes en " Ekskla#m'eIS@n kw'EstS@n m'A@k" "â‰"
test_phonemes en " Ekskla#m'eIS@n kw'EstS@n m'A@k r'eInboU" "â‰ ğŸŒˆ"
test_phonemes en " r'oUlIN 0nD@ fl'o@ l'aafIN" "ğŸ¤£" # skip words
# Test replacement rules
test_phonemes en " 'i:T@ d'i:m@n Ens,aIkl@p'oUdi@r- ,0n@m,at@p'oUIk a#m'i:b@ f'i:t@s l'0ft h'Ist@ri" "Ã†ther dÃ¦mon encyclopÅ“dia onomatopÅ“ic amÅ“ba fÅ“tus loï¬… hiï¬†ory"
# bug: https://github.com/espeak-ng/espeak-ng/issues/471
test_phonemes sk " sm'eju:tsa s'a tv'a:R" "â˜º"
test_phonemes sk " bl'ax sm'eju:tsa s'a tv'a:R" "blah â˜º"
