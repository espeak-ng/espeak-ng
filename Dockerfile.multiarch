# Dockerfile.multiarch

FROM --platform=$BUILDPLATFORM ubuntu:22.04

ARG ARCH
ARG COMPILER
ARG CONFIG

RUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get install -y \
  build-essential \
  clang \
  gcc \
  g++ \
  cmake \
  git \
  valgrind \
  ronn \
  kramdown \
  python3 \
  && rm -rf /var/lib/apt/lists/*

WORKDIR /app
COPY . .

RUN mkdir build && cd build && \
  cmake .. -DCMAKE_BUILD_TYPE=${CONFIG} && \
  make -j$(nproc)

CMD ["/bin/bash"]
